<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Coupling Finder</title>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.5.0/papaparse.min.js"></script> -->
    <script src="js/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="css/coupling.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <link rel="icon" type="image/x-icon" href="/imgs/fav/favicon.ico">
</head>

<body>
    <section class="Form my-5">
        <div class="container container-rad">
            <div class="row">
                <div class="col-lg-7 g-0 img-bg">
                    <div class="text-center img-center">
                        <img src="imgs/image001.png" alt="Schlumberger" class="img-fluid rounded">
                    </div>
                </div>
                <div class="col-lg-4 px-5 py-2">
                    <!-- <div class="row ">
                        <h1>TITLE</h1>
                    </div>
                    <div class="row ">
                        <h4>Connection Finder</h4>
                    </div> -->
                    <div class="row mt-4">
                        <div class="form mt-3 mb-3">
                            <div class="form-check form-check-inline">
                              <input class="form-check-input" type="radio" name="inlineRadioOptions" id="maximus" value="maximus">
                              <label class="form-check-label radio-label" for="inlineRadio1">Maximus</label>
                            </div>
                            <div class="form-check form-check-inline">
                              <input class="form-check-input" type="radio" name="inlineRadioOptions" id="nonmaximus" value="nonmaximus" checked>
                              <label class="form-check-label radio-label" for="inlineRadio2">Non-Maximus</label>
                            </div>
                        </div>
                        <div class="form mt-3 mb-3">
                            <div class="input-group">
                                <span class="input-group-text mb-1" id="basic-addon1">String</span>
                                <select id="esp_upper" class="form-select form-select-lg mb-1" onfocus="clear_form_upper()">
                                    <option id="series_u_blank"></option>
                                    <option value="u_pump">Pump</option>
                                    <option value="u_agh">AGH/MGH</option>
                                    <option value="u_intake">Intake</option>
                                    <option value="u_protector">Protector</option>
                                    <option value="u_motor">Motor</option>
                                    <option value="u_maxProtector">Maximus Protector</option>
									<option value="u_maxMotor">Maximus Motor</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <span class="input-group-text mb-1" id="basic-addon1">Type&nbsp;&nbsp;</span>
                                <select id="series_upper" class="form-select form-select-lg mb-1">
                                </select>
                            </div>
                            <!-- <select id="type_upper">
                                <option value="u_nonfs">Non Factory Shimming</option>
                                <option value="u_fs">Factory Shimming</option>
                                <option value="u_extshft">Extended Shaft</option>
                            </select> -->
                            <div class="input-group">
                                <span class="input-group-text mb-1" id="basic-addon1">Size&nbsp;&nbsp;&nbsp;</span>
                                <select id="shft_upper" class="form-select form-select-lg mb-1">
                                    <option id="series_u_blank"></option>
                                    <option value="0.62">0.62</option>
                                    <option value="0.68">0.68</option>
                                    <option value="0.87">0.87</option>
                                    <option value="1">1</option>
                                    <option value="1.18">1.18</option>
                                </select>
                            </div>
                        </div>
                        <div class="form mt-3 mb-3">
                            <div class="input-group">
                                <span class="input-group-text mb-1" id="basic-addon1">String</span>
                                <select id="esp_bottom" class="form-select form-select-lg mb-1" onfocus="clear_form_bottom()">
                                    <option id="series_u_blank"></option>
                                    <option value="b_pump">Pump</option>
                                    <option value="b_agh">AGH/MGH</option>
                                    <option value="b_intake">Intake</option>
                                    <option value="b_protector">Protector</option>
									<option value="b_maxProtector">Maximus Protector</option>
                                    <option value="b_motor">Motor</option>
									<option value="b_maxMotor">Maximus Motor</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <span class="input-group-text mb-1" id="basic-addon1">Type&nbsp;&nbsp;</span>
                                <select id="series_bottom" class="form-select form-select-lg mb-1">
                                </select>
                            </div>
                            <!-- <select id="type_bottom">
                                <option value="b_nonfs">Non Factory Shimming</option>
                                <option value="b_fs">Factory Shimming</option>
                                <option value="b_exthd">Extended Head</option>
                            </select> -->
                            <div class="input-group">
                                <span class="input-group-text mb-1" id="basic-addon1">Size&nbsp;&nbsp;&nbsp;</span>
                                <select id="shft_bottom" class="form-select form-select-lg mb-1">
                                    <option id="series_u_blank"></option>
                                    <option value="0.62">0.62</option>
                                    <option value="0.68">0.68</option>
                                    <option value="0.87">0.87</option>
                                    <option value="1">1</option>
                                    <option value="1.18">1.18</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3 mb-5">
                        <div>
                            <button class="btn btn-light btn-lg btn-color" data-bs-toggle="modal" data-bs-target="#exampleModal" onclick="search();">Search</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Information</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mt-2">
                            <span>Result</span>
                            <textarea class="form-control mb-3" id="result-coupling" rows="4"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <script src="js/series-shaft.js"></script>
    <script type="text/javascript">
    function search() {
        const socket = new WebSocket(location.origin.replace(/^http/, 'ws'));
        var jsonws = {};
        // clear Element
        document.getElementById('result-coupling').innerHTML = '';

        jsonws.esp_upper = document.getElementById('esp_upper').value;
        jsonws.series_upper = document.getElementById('series_upper').value;
        // jsonws.type_upper = document.getElementById('type_upper').value;
        jsonws.shft_upper = document.getElementById('shft_upper').value;
        jsonws.esp_bottom = document.getElementById('esp_bottom').value;
        jsonws.series_bottom = document.getElementById('series_bottom').value;
        // jsonws.type_bottom = document.getElementById('type_bottom').value;
        jsonws.shft_bottom = document.getElementById('shft_bottom').value;
        jsonws.maxornot = document.getElementById('maximus').checked;
        sendjson = JSON.stringify(JSON.stringify(jsonws));

        // Connection opened
        socket.addEventListener('open', function(event) {
            socket.send(sendjson);
			console.log(sendjson);
        });

        // Listen for messages
        socket.addEventListener('message', function(event) {
            console.log('Message from server ', event.data);
            document.getElementById('result-coupling').innerHTML = event.data;
        });

        // clear series form
        clear_series_upper();
        clear_series_bottom();
        document.getElementById('esp_upper').selectedIndex = 0;
        document.getElementById('esp_bottom').selectedIndex = 0;
    }

    function clear_esp_upper_bottom() {
        try {
            const esp_upper_id = document.getElementById('esp_upper');
            const esp_bottom_id = document.getElementById('esp_bottom')
            while (esp_upper_id.hasChildNodes()){
                esp_upper_id.removeChild(esp_upper_id.firstChild);
            }
            while (esp_bottom_id.hasChildNodes()){
                esp_bottom_id.removeChild(esp_bottom_id.firstChild);
            }
            console.log('clear_esp_upper_bottom');
        } catch (err) { console.log('Error: ' + err); }
    }

    function clear_esp_bottom() {
        try {
            const esp_bottom_id = document.getElementById('esp_bottom');
            while (esp_bottom_id.hasChildNodes()){
                esp_bottom_id.removeChild(esp_bottom_id.firstChild);
            }
            console.log('clear_esp_upper_bottom');
        } catch (err) { console.log('Error: ' + err); }
    }
    // delete shaft size element child
    function clear_series_upper() {
        try {
            const series_upper_id = document.getElementById('series_upper');
            const shaft_upper_id = document.getElementById('shft_upper')
            while (series_upper_id.hasChildNodes()){
                series_upper_id.removeChild(series_upper_id.firstChild);
            }
            while (shaft_upper_id.hasChildNodes()){
                shaft_upper_id.removeChild(shaft_upper_id.firstChild);
            }
        } catch (err) { console.log('Error: ' + err); }
    }
    function clear_series_bottom() {
        try {
            const series_bottom_id = document.getElementById('series_bottom');
            const shaft_bottom_id = document.getElementById('shft_bottom')
            while (series_bottom_id.hasChildNodes()){
                series_bottom_id.removeChild(series_bottom_id.firstChild);
            }
            while (shaft_bottom_id.hasChildNodes()){
                shaft_bottom_id.removeChild(shaft_bottom_id.firstChild);
            }
        } catch (err) { console.log('Error: ' + err); }
    }

    // add child series
    function insert_series(a,b,c,d) {
        clear_esp_upper_bottom();
        var elem = document.getElementById('esp_upper');
        var elem2= document.getElementById('esp_bottom');
        for (i in a) {
            option = document.createElement('option');
            option.text = a[i];
            option.value = c[i];
            elem.add(option);
        }
        for (i in b) {
            option = document.createElement('option');
            option.text = b[i];
            option.value = d[i];
            elem2.add(option);
        }
    }

    function insert_opt_upper(a,b) {
        var elem = document.getElementById('series_upper');
        var elem2= document.getElementById('shft_upper');
        for (i in a) {
            option = document.createElement('option');
            option.text = a[i];
            option.value = a[i];
            elem.add(option);
        }
        for (i in b) {
            option = document.createElement('option');
            option.text = b[i];
            option.value = b[i];
            elem2.add(option);
        }
    }
    function insert_opt_bottom(a,b) {
        var elem = document.getElementById('series_bottom');
        var elem2= document.getElementById('shft_bottom');
        for (i in a) {
            option = document.createElement('option');
            option.text = a[i];
            option.value = a[i];
            elem.add(option);
        }
        for (i in b) {
            option = document.createElement('option');
            option.text = b[i];
            option.value = b[i];
            elem2.add(option);
        }
    }

    
    // Select tag onchange
    function select_string_maximus(){
        clear_esp_upper_bottom();
        clear_series_bottom();
        clear_series_upper();
        insert_series(type.u_maximus,type.b_maximus,type.val_u_maximus,type.val_b_maximus);
        // insert_series(type.u_maximus,type.b_maximus,type.u_maximus,type.b_maximus);
    }

    function select_string_nonmaximus(){
        clear_esp_upper_bottom();
        clear_series_bottom();
        clear_series_upper();
        insert_series(type.u_non_maximus,type.b_non_maximus,type.val_u_non_maximus,type.val_b_non_maximus);
    }

    function select_series_upper() {
        var series = document.getElementById('esp_upper');
        document.getElementById('esp_bottom').selectedIndex = 0;
        console.log(series.value);
        clear_series_upper();
        clear_series_bottom();
    }
    function select_series_bottom() {
        var seriesu = document.getElementById('esp_upper');
        var seriesb = document.getElementById('esp_bottom');
        console.log(seriesu.value+' and '+seriesb.value);
        clear_series_bottom();
        if(seriesu.value=='u_pump' && seriesb.value=='b_pump') {
            insert_opt_upper(pump__pump.ps,pump__pump.sd);
            insert_opt_bottom(pump__pump.ps2,pump__pump.sd2);
        } else if (seriesu.value=='u_pump' && seriesb.value=='b_agh') {
            insert_opt_upper(pump__agh_mgh.ps,pump__agh_mgh.sd);
            insert_opt_bottom(pump__agh_mgh.ps2,pump__agh_mgh.sd2);
        } else if (seriesu.value=='u_agh' && seriesb.value=='b_intake') {
            insert_opt_upper(agh_mgh__intake.ps,agh_mgh__intake.sd);
            insert_opt_bottom(agh_mgh__intake.ps2,agh_mgh__intake.sd2);
        } else if ((seriesu.value=='u_pump' && seriesb.value=='b_protector')||(seriesu.value=='u_agh' && seriesb.value=='b_protector')) {
            insert_opt_upper(pump_agh__protector.ps,pump_agh__protector.sd);
            insert_opt_bottom(pump_agh__protector.ps2,pump_agh__protector.sd2);
        } else if (seriesu.value=='u_pump' && seriesb.value=='b_intake') {
            insert_opt_upper(pump__intake.ps,pump__intake.sd);
            insert_opt_bottom(pump__intake.ps2,pump__intake.sd2);
        } else if (seriesu.value=='u_intake' && seriesb.value=='b_protector') {
            insert_opt_upper(intake__protector.ps,intake__protector.sd);
            insert_opt_bottom(intake__protector.ps2,intake__protector.sd2);
        } else if (seriesu.value=='u_protector' && seriesb.value=='b_protector') {
            insert_opt_upper(protector__protector.ps,protector__protector.sd);
            insert_opt_bottom(protector__protector.ps2,protector__protector.sd2);
        } else if (seriesu.value=='u_protector' && seriesb.value=='b_motor') {
            insert_opt_upper(protector__motor.ps,protector__motor.sd);
            insert_opt_bottom(protector__motor.ps2,protector__motor.sd2);
        } else if (seriesu.value=='u_motor' && seriesb.value=='b_motor') {
            insert_opt_upper(motor__motor.ps,motor__motor.sd);
            insert_opt_bottom(motor__motor.ps2,motor__motor.sd2);
                                // Below for Maximus only
        } 
        /*
         *Below only for Maximus
         */    
        // else if(type.val_u_maximus.includes(seriesu.value) && (seriesb.value=='max_pro_fs_maxj' || seriesb.value=='max_pro_ut_fs_maxj' || seriesb.value=='max_pro_s_lt_fs_maxj' || seriesb.value=='max_promotor_s_ut_fs_maxj')) {
        else if(mgh_agh_intake_pump_LT__Max_prot_promotor.sname.includes(seriesu.value) && mgh_agh_intake_pump_LT__Max_prot_promotor.sname2.includes(seriesb.value)) {
            insert_opt_upper(mgh_agh_intake_pump_LT__Max_prot_promotor.ps,mgh_agh_intake_pump_LT__Max_prot_promotor.sd);
            insert_opt_bottom(mgh_agh_intake_pump_LT__Max_prot_promotor.ps2,mgh_agh_intake_pump_LT__Max_prot_promotor.sd2);
        }
        else if(maxProtector__maxProtector_promotor.sname.includes(seriesu.value) && maxProtector__maxProtector_promotor.sname2.includes(seriesb.value)) {
            insert_opt_upper(maxProtector__maxProtector_promotor.ps, maxProtector__maxProtector_promotor.sd);
            insert_opt_bottom(maxProtector__maxProtector_promotor.ps2, maxProtector__maxProtector_promotor.sd2);
        }
        else if (maxProtector__std_motor_dominator_max_motor.sname.includes(seriesu.value) && maxProtector__std_motor_dominator_max_motor.sname2.includes(seriesb.value)) {
            insert_opt_upper(maxProtector__std_motor_dominator_max_motor.ps, maxProtector__std_motor_dominator_max_motor.sd);
            insert_opt_bottom(maxProtector__std_motor_dominator_max_motor.ps2, maxProtector__std_motor_dominator_max_motor.sd2);
        } else if (maxUT_motor_promotor__maxCT_LT_motor.sname.includes(seriesu.value) && maxUT_motor_promotor__maxCT_LT_motor.sname2.includes(seriesb.value)) {
            insert_opt_upper(maxUT_motor_promotor__maxCT_LT_motor.ps, maxUT_motor_promotor__maxCT_LT_motor.sd);
            insert_opt_bottom(maxUT_motor_promotor__maxCT_LT_motor.ps2, maxUT_motor_promotor__maxCT_LT_motor.sd2);
        } else {
            console.log('not found, the type:');
             
        }
    }

    // Select tage onFocus
    function clear_form_upper() {
        document.getElementById('series_upper').value = '';
        document.getElementById('shft_upper').value = '';
    }

    function clear_form_bottom() {
        document.getElementById('series_bottom').value = '';
        document.getElementById('shft_bottom').value = '';
    }

    // Select tag Event Listener 
    const su = document.getElementById('esp_upper');
    const sb = document.getElementById('esp_bottom');
    const mx = document.getElementById('maximus');
    const nmx= document.getElementById('nonmaximus');

    su.addEventListener('change', select_series_upper);
    sb.addEventListener('change', select_series_bottom);
    mx.addEventListener('change', select_string_maximus);
    nmx.addEventListener('change',select_string_nonmaximus);
    </script>
</body>

</html>